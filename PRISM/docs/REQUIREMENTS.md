# PRISM システム要件定義書

**バージョン**: 1.0.0  
**作成日**: 2025年10月21日  
**最終更新**: 2025年10月21日

---

## 1. システム概要

### 1.1 目的
Notionに入力されたデータをChatGPT APIで自動分類し、タスク管理・知識管理・ノート管理を統合的に行える、自然言語で問い合わせ可能なシステムを構築する。

### 1.2 システム名称
**PRISM** (Programmatic Repository for Intelligent Structured Management)

### 1.3 対象ユーザー
- 個人のタスク・知識・習慣管理を行うユーザー
- Notionを情報入力のインターフェースとして活用したいユーザー
- 自然言語での検索・問い合わせを行いたいユーザー

---

## 2. 機能要件

### 2.1 分類機能（Core）

#### 2.1.1 自動分類
- **要件ID**: REQ-001
- **優先度**: 高
- **説明**: Notionページを「Task」「Knowledge」「Note」の3つのカテゴリに自動分類
- **入力**: タイトル、本文、プロパティ、タグ
- **出力**: カテゴリ、信頼度スコア、分類理由、タグ

#### 2.1.2 分類ロジック
- **要件ID**: REQ-002
- **優先度**: 高
- **説明**: プラグイン方式で拡張可能な分類ロジック
- **仕様**:
  - キーワードベースの分類（日本語・英語対応）
  - スコアリングによる優先順位付け
  - LLMフォールバック機能

#### 2.1.3 分類精度
- **要件ID**: REQ-003
- **優先度**: 高
- **説明**: 分類精度90%以上を目標
- **評価指標**:
  - Task分類精度: 95%以上
  - Knowledge分類精度: 95%以上
  - Note分類精度: 90%以上

### 2.2 検索・問い合わせ機能

#### 2.2.1 自然言語検索
- **要件ID**: REQ-004
- **優先度**: 中
- **説明**: 自然言語での検索・問い合わせ機能
- **仕様**:
  - キーワード検索
  - タイプ別フィルタ（Task/Knowledge/Note）
  - タグ別フィルタ

#### 2.2.2 検索結果
- **要件ID**: REQ-005
- **優先度**: 中
- **説明**: 検索結果の表示とソート
- **仕様**:
  - 関連度順のソート
  - ページネーション
  - メタデータ表示

### 2.3 同期機能

#### 2.3.1 Notion同期
- **要件ID**: REQ-006
- **優先度**: 高
- **説明**: Notionからのデータ同期
- **仕様**:
  - 定期的な自動同期（デフォルト: 60秒間隔）
  - 手動同期トリガー
  - 差分同期

#### 2.3.2 データ保存
- **要件ID**: REQ-007
- **優先度**: 中
- **説明**: 分類結果のCSV形式での保存
- **仕様**:
  - NoyionDB_CSV/配下にカテゴリ別CSV保存
  - Task.csv, Knowledge.csv, Note.csv

### 2.4 API機能

#### 2.4.1 RESTful API
- **要件ID**: REQ-008
- **優先度**: 高
- **説明**: RESTful APIの提供
- **エンドポイント**:
  - `GET /healthz` - ヘルスチェック
  - `POST /classify` - 分類実行
  - `GET /query` - 検索
  - `POST /sync/notion` - Notion同期

#### 2.4.2 認証
- **要件ID**: REQ-009
- **優先度**: 高
- **説明**: APIキー認証
- **仕様**:
  - X-API-Keyヘッダーによる認証
  - 環境変数での設定

### 2.5 Web UI

#### 2.5.1 Web インターフェース
- **要件ID**: REQ-010
- **優先度**: 中
- **説明**: シンプルなHTML/JSベースのWeb UI
- **機能**:
  - 分類実行
  - 検索
  - 結果表示

---

## 3. 非機能要件

### 3.1 性能要件

#### 3.1.1 応答時間
- **要件ID**: NFR-001
- **優先度**: 高
- **説明**: API応答時間
- **目標値**:
  - ヘルスチェック: 100ms以内
  - 分類処理: 2秒以内
  - 検索処理: 1秒以内

#### 3.1.2 同時接続数
- **要件ID**: NFR-002
- **優先度**: 中
- **説明**: 同時処理数
- **目標値**: 10リクエスト/秒

### 3.2 可用性要件

#### 3.2.1 稼働率
- **要件ID**: NFR-003
- **優先度**: 中
- **説明**: システム稼働率
- **目標値**: 95%以上

#### 3.2.2 ヘルスチェック
- **要件ID**: NFR-004
- **優先度**: 高
- **説明**: ヘルスチェック機能
- **仕様**:
  - 10秒間隔でのヘルスチェック
  - 5回連続失敗で異常判定

### 3.3 拡張性要件

#### 3.3.1 プラグイン機能
- **要件ID**: NFR-005
- **優先度**: 高
- **説明**: プラグインによる拡張性
- **仕様**:
  - 分類ロジックのプラグイン化
  - register()とclassify()インターフェース
  - 動的プラグイン検出

#### 3.3.2 モジュール化
- **要件ID**: NFR-006
- **優先度**: 高
- **説明**: モジュール化されたアーキテクチャ
- **仕様**:
  - API、Worker、Web UIの分離
  - MCP抽象化レイヤー

### 3.4 セキュリティ要件

#### 3.4.1 認証情報管理
- **要件ID**: NFR-007
- **優先度**: 高
- **説明**: 機密情報の安全な管理
- **仕様**:
  - 環境変数での設定
  - ハードコード禁止
  - .gitignoreによる除外

#### 3.4.2 ログ管理
- **要件ID**: NFR-008
- **優先度**: 中
- **説明**: ログへのPII情報非記載
- **仕様**:
  - 個人情報のマスキング
  - 構造化ログ（JSON）とヒューマンリーダブルログの両対応

### 3.5 運用要件

#### 3.5.1 Docker対応
- **要件ID**: NFR-009
- **優先度**: 高
- **説明**: Dockerによるコンテナ化
- **仕様**:
  - docker-compose.ymlによる一括起動
  - Mac/Windows/Linux対応
  - ポート設定: API(8060), Web(8061)

#### 3.5.2 ログ出力
- **要件ID**: NFR-010
- **優先度**: 中
- **説明**: 構造化ログの出力
- **仕様**:
  - JSON形式とヒューマンリーダブル形式
  - ログレベル設定（DEBUG/INFO/WARN/ERROR）

### 3.6 国際化要件

#### 3.6.1 多言語対応
- **要件ID**: NFR-011
- **優先度**: 中
- **説明**: 日本語・英語対応
- **仕様**:
  - 日本語優先
  - エラーメッセージの日英対応

---

## 4. 技術要件

### 4.1 技術スタック

#### 4.1.1 バックエンド
- **言語**: Python 3.11+
- **フレームワーク**: FastAPI 0.115.0
- **サーバー**: Uvicorn 0.30.6
- **ライブラリ**:
  - Pydantic 2.9.2（データバリデーション）
  - httpx 0.27.2（HTTP通信）

#### 4.1.2 フロントエンド
- **言語**: HTML/JavaScript
- **サーバー**: Nginx 1.27-alpine
- **フレームワーク**: なし（シンプルなSPA非採用）

#### 4.1.3 インフラ
- **コンテナ**: Docker
- **オーケストレーション**: Docker Compose
- **VPN**: Tailscale（オプション）

### 4.2 外部サービス連携

#### 4.2.1 OpenAI API
- **用途**: LLMによる分類
- **モデル**: GPT-4 / GPT-3.5-turbo（推奨）

#### 4.2.2 Notion API
- **用途**: データソース
- **バージョン**: 2022-06-28以降

#### 4.2.3 MCP (Model Context Protocol)
- **用途**: Notion API抽象化レイヤー
- **URL**: http://mcp-server:8063

---

## 5. 制約条件

### 5.1 技術的制約
- Python 3.11以上必須
- Docker & Docker Compose必須
- ネットワーク接続必須（OpenAI API、Notion API利用）

### 5.2 環境制約
- Mac/Windows/Linux対応
- 最小メモリ: 2GB
- 最小ディスク: 1GB

### 5.3 運用制約
- シングルユーザー運用
- データベース不使用（CSV保存）

---

## 6. 受け入れ基準

### 6.1 機能受け入れ基準
- [ ] docker-compose up -d で全サービスが起動
- [ ] /healthz が200 OKを返す
- [ ] /classify がTask/Knowledge/Noteを正しく分類
- [ ] 分類精度テストで90%以上を達成
- [ ] プラグインの追加が可能

### 6.2 品質受け入れ基準
- [ ] 全ユニットテストがパス
- [ ] 統合テストがパス
- [ ] セキュリティスキャンでクリティカル問題なし
- [ ] ドキュメントが整備されている

### 6.3 運用受け入れ基準
- [ ] セットアップガイドに従って30分以内に構築可能
- [ ] ログが適切に出力される
- [ ] エラー時の復旧手順が明確

---

## 7. 今後の拡張予定

### 7.1 フェーズ2（中期）
- 習慣トラッキング機能
- グラフ可視化
- データベース統合（SQLite/PostgreSQL）
- マルチユーザー対応

### 7.2 フェーズ3（長期）
- AIアシスタント統合
- モバイルアプリ
- リアルタイム同期
- クラウドデプロイ対応

---

## 8. 付録

### 8.1 用語集
- **PRISM**: 本システムの名称
- **MCP**: Model Context Protocol（Notion API抽象化）
- **Task**: タスク・ToDo・締切のあるアクション
- **Knowledge**: 知識・ナレッジ・技術情報
- **Note**: メモ・日記・備忘録

### 8.2 参考資料
- [FastAPI公式ドキュメント](https://fastapi.tiangolo.com/)
- [Notion API公式ドキュメント](https://developers.notion.com/)
- [OpenAI API公式ドキュメント](https://platform.openai.com/docs)

---

**文書履歴**

| バージョン | 日付 | 変更内容 | 作成者 |
|-----------|------|---------|--------|
| 1.0.0 | 2025-10-21 | 初版作成 | PRISM Team |


